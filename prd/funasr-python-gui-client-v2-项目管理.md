# FunASR Python GUI Client V2 - 后续开发计划

根据需求文档的第二阶段开发建议，整理的待办事项列表：

## 用户体验优化 (UI/UX)

- [ ] **(P1) 状态栏信息增强:**
    - [ ] 显示更详细的识别阶段（读取文件、上传进度、服务器处理、接收结果等）。
    - [ ] 使用不同颜色/图标区分状态（成功、进行中、警告、错误）。
    - [ ] 实现短暂信息（如"文件已选择"）几秒后自动恢复。
- [ ] **(P0) 结果与日志分离:**
    - [ ] 使用 `ttk.Notebook` 或 `tk.PanedWindow` 分割界面。
    - [ ] 创建独立的"识别结果"区域，只显示最终文本。
    - [ ] 提供"复制结果"按钮。
    - [ ] 创建独立的"运行日志"区域，显示详细过程、调试和错误信息。
    - [ ] （可选）在日志区域添加日志级别控制（如"显示调试信息"）。
- [ ] **(P0) 增强错误处理:**
    - [ ] 捕获常见的网络、文件、服务器错误。
    *   [ ] 以友好的方式（弹窗或状态栏提示）告知用户。
- [ ] **(P1) 添加"取消"按钮:**
    - [ ] 允许用户中止正在进行的识别任务（需要能终止子进程或关闭 WebSocket）。
- [ ] **(P2) UI/UX 细节打磨:**
    - [ ] 调整控件间距和对齐。
    - [ ] 为关键控件添加 Tooltips 提示。
- [x] **(P2) 配置持久化:**
    - [x] 保存上次使用的服务器 IP、端口。
    - [x] 保存上次使用的高级选项（ITN, SSL 等）。
    - [x] 程序启动时自动加载保存的配置。
    - [x] 配置文件保存在 `release/config/config.json`。
- [ ] **(P1) 进度显示优化:**
    - [ ] 优化实时进度显示（代码中已有处理 `\r` 的尝试，但需改进）。
    - [ ] 添加进度条显示总体完成百分比。
    - [ ] 在文件较大时提供预估剩余时间。

## 功能扩展

- [ ] **(P2) 支持 Online 模式:**
    - [ ] 添加模式选择控件 (Offline, Online, 2Pass)。
    - [ ] 允许配置 Online 模式的参数 (`--chunk_size`, `--chunk_interval`)。
    - [ ] 处理并显示实时返回的中间结果。
- [ ] **(P2) 支持 2Pass 模式:**
    - [ ] 添加模式选择控件 (Offline, Online, 2Pass)。
    - [ ] 允许配置 2Pass 模式的参数 (`--chunk_size`, `--chunk_interval`)。
    - [ ] 处理并显示相关的结果。
- [ ] **(P1) 支持热词文件:**
    - [ ] 添加"选择热词文件"按钮和路径显示框。
    - [ ] 将热词文件路径传递给 `--hotword` 参数。
    - [ ] （可选）提供热词文件格式的简单说明。
- [x] **(P1) 配置输出目录:**
    - [x] 识别结果默认保存到 `release/results` 目录。
    - [x] 识别完成后提示结果已保存。
    - [x] 提供"打开结果目录"按钮。
    - [ ] （可选）添加输入框允许用户自定义输出目录。
- [ ] **(P2) 优化多文件处理 (.scp):**
    - [ ] 在日志或状态栏显示当前处理的文件名。
    - [ ] 显示 `.scp` 文件处理的总体进度。
- [ ] **(P2) 批量处理增强:**
    - [ ] 提供更友好的多文件处理界面。
    - [ ] 支持拖放多个文件。
    - [ ] 添加处理队列和任务管理。
- [ ] **(P3) 高级参数暴露:**
    - [ ] 添加更多高级参数的配置界面（例如 `--send_without_sleep`、`--sample_rate` 等）。
    - [ ] 提供参数帮助说明。
- [x] **(P1) 速度测试功能:**
    - [x] 添加速度测试按钮和结果显示区域。
    - [x] 使用 demo 目录中的测试文件进行上传和转写速度测试。
    - [x] 计算并显示上传速度（MB/s）和转写速度（倍速）。
    - [x] 支持状态显示（未测试、测试进行中、测试完成）。

## 性能与可靠性

- [x] **(P1) 优化 Offline 上传速度:**
    - [ ] 调研并决定是否在调用脚本时添加 `--send_without_sleep` 参数。
    - [ ] 或考虑修改 `simple_funasr_client.py` 移除 offline 模式下的 `sleep`。
- [x] **(P1) 确保 Offline 模式协议正确性:**
    - [x] 修正 `simple_funasr_client.py` 在 offline 模式下发送的初始消息，使其不包含 chunk 参数。
    - [x] 修正 `simple_funasr_client.py` 对单个文件输入时的 `wav_name` 处理。
- [ ] **(P2) 暴露并发参数:**
    - [ ] 在高级选项中添加 `--thread_num` 的配置，用于 `.scp` 文件处理。
- [x] **(P0) 生成独立的日志文件:**
    - [x] 引入 Python `logging` 模块。
    - [x] 将日志同时输出到"运行日志"区域和本地文件 (`release/logs/funasr_gui_client.log`)。
    - [x] 日志包含时间戳、级别和类别前缀。
    - [x] 已实现日志轮转 (`RotatingFileHandler`)。
    - [x] 已提供"打开日志文件"的按钮。
- [ ] **(P3) (高级) 直接 WebSocket 集成:**
    - [ ] 评估将 WebSocket 逻辑直接整合到 GUI 后台线程的可行性和收益。
    - [ ] （如果实施）重构后台处理逻辑，移除 `subprocess` 调用。
- [ ] **(P2) 依赖管理改进:**
    - [ ] 改进依赖检查和安装机制（解决SSL证书问题）。
    - [ ] 提供更友好的依赖安装失败处理。
    - [ ] 考虑使用虚拟环境或捆绑依赖（如打包时）。

## 文件结构优化

- [x] **(P1) 文件路径优化:**
    - [x] 将配置文件从 `src/python-gui-client/config.json` 移动到 `release/config/config.json`。
    - [x] 将日志文件从 `src/python-gui-client/funasr_gui_client.log` 移动到 `release/logs/funasr_gui_client.log`。
    - [x] 将识别结果输出目录设置为 `release/results`。
    - [x] 添加"打开结果目录"按钮，方便用户查看识别结果。
    - [x] 实现旧配置文件和日志文件的自动迁移功能。

## 分发与其他

- [ ] **(P1) 打包:**
    - [ ] 使用 nuitka 创建可执行文件。
    - [ ] 确保包含所有依赖项。
- [ ] **(P3) 国际化支持:**
    - [ ] 添加英语界面选项。
    - [ ] 实现语言切换功能。
- [ ] **(P3) 自动更新检查:**
    - [ ] 添加检查新版本的功能。
    - [ ] 提供更新提示或自动更新选项。
