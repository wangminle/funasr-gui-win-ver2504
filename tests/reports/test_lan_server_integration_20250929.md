# 测试总结：局域网服务器联调（连接/测速/识别）- 2025-09-29

## 测试范围
- 连接测试（10秒超时可配置）
- 速度测试（双文件：`tv-report-1.mp4`、`tv-report-1.wav`）
- 识别测试（3次：`tv-report-1.wav`×2、`test001.wav`）
- 校验：严格化成功判定、生效的 stderr 实时输出、禁用代理、测速兜底策略

## 测试环境
- 客户端：`funasr_gui_client_v2.py`（GUI）；`simple_funasr_client.py`（子进程）
- 服务端：LAN `100.116.250.20:10095`，SSL 启用
- 配置：`connection_test_timeout = 10`

## 主要用例与结果
1) 连接测试
   - 17:02:41/17:14:59 建立 TLS 连接并发送测试消息；10秒内未收到响应，日志提示“未在超时时间内收到WebSocket服务器响应，但连接已建立”。
   - 结论：网络连通与握手正常；部分服务端策略对首包不返回响应属预期，后续业务流可继续。

2) 速度测试
   - 17:15:11 启动；文件1上传≈58.98s、转写≈10.60s；文件2上传≈14.46s、转写≈9.72s；
   - 结果：上传速度 0.36 MB/s，转写速度 17.72x（满足展示和统计需求）。

3) 识别测试 ×3
   - 17:17:11 `tv-report-1.wav`：出现连续上传进度（10%→100%）、`is_speaking=false` 后收到“识别结果”与“处理完成”；GUI 判定成功。
   - 17:17:44 `tv-report-1.wav`：同上流程完整；GUI 判定成功。
   - 17:18:42 `test001.wav`：同上流程完整；GUI 判定成功。

4) 严格化成功判定与 stderr 实时输出
   - 17:04:08 可见子进程 stderr 抛出 `ImportError: python-socks is required to use a SOCKS proxy`（修复前遗留）；
   - 后续识别均未再出现该错误，说明“禁用代理（proxy=None）”与“异常非零退出码”生效；GUI 仅在捕获到“识别结果”或输出文件存在时标记成功，符合预期。

## 日志对照要点
- 客户端：
  - 连接阶段：多次出现“未在超时时间内收到…但连接已建立”，与预期一致；
  - 速度测试与识别阶段：均出现“发送WebSocket配置”“上传进度”“is_speaking=false”“识别结果”“处理完成”完整序列；
- 服务端：
  - 对应时段出现 `on_open`、bias LM 构建、`client done` 与大段 result json，内容与客户端“识别结果”匹配（两端时间戳存在数十秒级偏差，推测为系统时间不同步所致，不影响功能）。

## 结论
- 本次联调结果：连接可达、测速完成、三次识别成功，客户端严格成功判定与错误可视化均达成。

## 建议
- 可选优化：在“已握手但无响应”的场景，内部连接状态与提示语保持一致（避免个别分支仍提示“未检测到服务器连接”）。
- 可选监测：若需进一步分析链路抖动，建议在速度测试中记录分段上传的时间分布与抖动统计。


