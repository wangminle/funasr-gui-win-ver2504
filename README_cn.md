# FunASR GUI 客户端 V2

这是一个基于 Tkinter 的图形用户界面 (GUI) 客户端，用于与 FunASR (FunASR ASR) WebSocket 服务进行交互，实现语音识别功能。

## ✨ 功能特性

*   **服务器连接配置**: 允许用户输入 FunASR WebSocket 服务器的 IP 地址和端口。
*   **连接测试**: 提供按钮测试与服务器的 WebSocket 连接状态（包括 SSL）。
*   **文件选择**: 支持选择本地的音频/视频文件（如 `.wav`, `.mp3`, `.pcm`, `.mp4` 等）或 `.scp` 列表文件进行识别。
*   **离线识别**: 通过调用客户端脚本 (`simple_funasr_client.py`) 执行 FunASR 的离线识别模式。
*   **实时输出显示**: 在 GUI 中实时显示识别过程中的状态信息和最终识别结果。
*   **高级选项**: 支持启用/禁用逆文本标准化 (ITN) 和 SSL 连接。
*   **依赖检查与安装**: 自动检查并提示/尝试安装所需的 Python 依赖包 (`websockets`, `asyncio`)。
*   **状态反馈**: 通过状态栏和输出区域提供清晰的操作状态反馈。
*   **日志记录**: 生成独立的日志文件，包含详细的操作记录和错误信息，便于问题排查。
*   **配置持久化**: 保存上次使用的服务器IP、端口和高级选项设置，下次启动时自动加载。
*   **优化上传速度**: 针对离线模式进行了上传速度优化，提高了处理效率。
*   **协议优化**: 修正了offline模式下的协议处理，确保与服务端正确通信。
*   **文件结构优化**: 重构了文件存储结构，将配置文件、日志和识别结果分别存储在独立目录中。
*   **服务器速度测试**: 提供专用按钮测试服务器的上传速度和转写速度，使用demo目录中的测试文件计算并显示上传速度（MB/s）和转写速度（倍时）。
*   **国际化支持**: 提供中英文界面切换功能，满足不同语言背景用户的需求。

## 🐍 环境要求

*   **Python**: 3.8 或更高版本 (推荐使用项目运行时使用的 Python 版本，例如 3.12)。
*   **Tkinter**: Python 标准库，通常随 Python 安装。
*   **必要的 Python 包**:
    *   `websockets`: 用于 WebSocket 通信。
    *   `asyncio`: 用于异步操作。
    *   `logging`: 用于生成日志文件（Python 标准库）。
    *   *(注意: GUI 客户端会在首次连接或识别时尝试自动安装这些依赖)*

## 🚀 安装与设置

1.  **获取代码**: 克隆或下载本仓库到您的本地计算机。
2.  **FunASR 服务端**: 确保您已经按照 FunASR 官方文档部署并运行了 WebSocket 服务端 (包括 `wss_server_online.py` 或 `wss_server_offline.py`)。记下服务端的 IP 地址和端口。
3.  **安装依赖**:
    *   您可以手动安装:
        ```bash
        pip install websockets asyncio
        ```
    *   或者，启动 GUI 客户端，它会在需要时尝试自动安装。

## 🛠️ 使用方法

1.  **启动 GUI**:
    ```bash
    cd path/to/funasr-gui-win-ver2504 # 进入项目根目录
    python src/python-gui-client/funasr_gui_client_v2.py
    ```
2.  **配置服务器**: 在 "服务器连接配置" 区域输入 FunASR WebSocket 服务器的 IP 地址和端口。
3.  **测试连接 (可选)**: 点击 "连接服务器" 按钮检查网络连通性。连接成功后，指示灯会变绿。
4.  **选择文件**: 点击 "选择音/视频文件" 按钮，选择您要识别的音频或视频文件。
5.  **配置选项 (可选)**: 根据需要勾选或取消勾选 "启用 ITN" 和 "启用 SSL"。
6.  **切换语言 (可选)**: 从语言下拉框中选择"中文"或"English"来切换界面语言。
7.  **开始识别**: 点击 "开始识别" 按钮。
8.  **查看结果**: 识别过程中的日志和最终结果将显示在 "运行日志与结果" 区域。状态栏会显示当前状态。识别结果文本文件将保存在 `release/results/` 目录下。
9.  **查看日志**: 点击 "打开日志文件" 按钮可以打开日志文件，查看详细的操作记录和错误信息。
10. **查看识别结果**: 点击 "打开结果目录" 按钮可以直接打开保存识别结果的目录。
11. **测试服务器速度**: 点击 "速度测试" 按钮可以测试服务器的上传速度和转写速度。测试会自动使用demo目录中的测试文件（tv-report-1.mp4和tv-report-1.wav）进行两次测试，并计算平均上传速度（MB/s）和转写速度（倍时）。测试完成后，会在界面上显示结果，并弹出详细的测试结果对话框。

## 📁 文件结构

```
funasr-gui-win-ver2504/
├── src/
│   └── python-gui-client/
│       ├── funasr_gui_client_v2.py   # GUI 客户端主程序
│       ├── language_resources.py     # 语言资源文件，包含中英文字符串映射
│       └── simple_funasr_client.py   # 实际执行识别的 WebSocket 客户端脚本
├── release/
│   ├── config/                       # 配置文件目录
│   │   └── config.json               # 保存用户配置的文件
│   ├── logs/                         # 日志文件目录
│   │   └── funasr_gui_client.log     # 程序运行日志文件
│   └── results/                      # 存放识别结果文本文件的目录
│       └── speed_test/               # 存放速度测试结果的子目录
├── ref_codes/                        # 参考代码目录
│   ├── funasr_client_api.py          # FunASR 客户端 API
│   ├── funasr_wss_client.py          # FunASR 原始 WebSocket 客户端
│   └── requirements_client.txt       # 客户端依赖项列表
├── ref_docs/                         # 参考文档目录
├── demo/                             # 演示音视频文件目录
│   ├── tv-report-1.mp4               # 示例视频文件 (用于速度测试)
│   └── tv-report-1.wav               # 示例音频文件 (用于速度测试)
├── prd/                              # 项目需求和文档目录
│   ├── funasr-python-gui-client-v2-需求文档.md # 项目需求文档
│   ├── funasr-python-gui-client-v2-项目管理.md # 项目管理文档
│   ├── funasr-python-gui-client-v2-UI定义.md   # UI 详细定义文档
│   ├── FunASR客户端流程记录.md                 # 客户端与服务端交互流程记录
│   └── FunASR-performance.md                   # 性能测试记录
├── README.md                                   # 项目主 README (英文版)
└── README_cn.md                                # 本文档 (中文版 README)
```

## ⚠️ 已知问题与限制

*   当前主要支持 FunASR 的 **离线 (offline)** 识别模式。
*   错误处理和提示可以进一步完善。
*   暂未实现对所有 `funasr_wss_client.py` 命令行参数的可视化配置（如 `chunk_size`, `chunk_interval`, `hotword` 等）。

## 🔜 开发计划

根据项目管理文档，以下功能正在开发中：

*   **结果与日志分离**: 将识别结果与运行日志分开显示，提供更清晰的用户体验。
*   **状态栏信息增强**: 显示更详细的识别阶段和进度信息。
*   **增强错误处理**: 捕获并友好显示常见错误。
*   **添加"取消"按钮**: 允许用户中止正在进行的识别任务。
*   **支持热词文件**: 添加选择热词文件的功能，提高特定领域识别准确率。
*   **配置输出目录**: 允许用户自定义结果保存位置。
*   **支持 Online 和 2Pass 模式**: 扩展支持更多识别模式，满足不同场景需求。
*   **国际化支持完善**: 完善中英文界面切换功能，改进用户体验，便于添加更多语言支持。

## 🤝 贡献

欢迎提出问题、报告错误或贡献代码改进！

## 📄 许可证

(可在此添加许可证信息，例如 MIT License) 